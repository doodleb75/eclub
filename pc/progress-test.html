<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Bar Test</title>
    <style>
        /* 기본 리셋 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            padding: 50px;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            /* box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); */
        }

        h2 {
            margin-bottom: 30px;
            text-align: center;
            color: #333;
        }

        /* 컨트롤 패널 */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
            padding: 20px;
            background: #f9f9f9;
            border: 1px solid #eee;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-size: 14px;
            font-weight: bold;
            color: #555;
        }

        .input-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #ff0000;
        }

        /* 프로그래스 바 영역 */
        .progress-wrapper {
            position: relative;
            padding: 0 0 40px 0;
            margin-top: 50px;
        }

        /* 타입 라벨 */
        .type-label {
            font-size: 14px;
            font-weight: bold;
            color: #555;
            margin-bottom: 60px;
        }

        .type-label em {
            color: #ff0000;
            font-style: normal;
        }

        .progress-track {
            position: relative;
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: visible;
        }

        .progress-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: #ff0000;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
            z-index: 1;
        }

        /* 마커 */
        .marker {
            position: absolute;
            top: -5px;
            width: 2px;
            height: 20px;
            background-color: #333;
            transform: translateX(-50%);
            z-index: 2;
        }

        .marker-label {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            color: #333;
            font-weight: bold;
            white-space: nowrap;
        }

        .marker-amount {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #888;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        /* 마커 도달 시 강조 */
        .marker-amount.is-reached {
            color: #ff0000;
            font-weight: bold;
            font-size: 13px;
        }

        /* 결과 텍스트 */
        .result-text {
            margin-top: 60px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .result-text span {
            color: #ff0000;
        }

        /* 셀렉트 박스 스타일 */
        select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background-color: #fff;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #ff0000;
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>장려금지급기준​ Progress Bar</h2>

        <div class="controls">
            <div class="input-group">
                <label for="typeSelect">유형 선택</label>
                <select id="typeSelect">
                    <option value="type-a">소매</option>
                    <option value="type-b">도매</option>
                </select>
            </div>
            <div class="input-group" id="inputGroupA">
                <label for="currentMoneyA">소매 - 현재 달성 금액</label>
                <input type="number" id="currentMoneyA" value="1500" placeholder="금액 입력">
            </div>
            <div class="input-group" id="inputGroupB" style="display: none;">
                <label for="currentMoneyB">도매 - 현재 달성 금액</label>
                <input type="number" id="currentMoneyB" value="1500" placeholder="금액 입력">
            </div>
        </div>

        <!-- A타입 프로그래스 바 (소매) -->
        <div class="progress-wrapper" id="wrapperA">
            <div class="type-label"><em>소매</em> (0.5%=1,500 / 1%=2,000 / 2%=3,000 / 3%=4,000)</div>
            <div class="progress-track type-a" id="progressTrackA" data-input="currentMoneyA">
                <div class="progress-fill"></div>
                <!-- 0.5 (16.66%) -->
                <div class="marker" style="left: 16.66%;">
                    <span class="marker-amount"></span>
                    <span class="marker-label">0.5%</span>
                </div>
                <!-- 1.0 (33.33%) -->
                <div class="marker" style="left: 33.33%;">
                    <span class="marker-amount"></span>
                    <span class="marker-label">1%</span>
                </div>
                <!-- 2.0 (66.66%) -->
                <div class="marker" style="left: 66.66%;">
                    <span class="marker-amount"></span>
                    <span class="marker-label">2%</span>
                </div>
                <!-- 3.0 (100%) -->
                <div class="marker" style="left: 100%;">
                    <span class="marker-amount"></span>
                    <span class="marker-label">3%</span>
                </div>
            </div>
            <div class="result-text">
                현재 진행률: <span class="current-percent">0%</span>
            </div>
        </div>

        <!-- B타입 프로그래스 바 (도매) -->
        <div class="progress-wrapper" id="wrapperB" style="display: none;">
            <div class="type-label"><em>도매</em> (0.5%=1,500 / 1%=3,000 / 2%=4,000 / 3%=5,000)</div>
            <div class="progress-track type-b" id="progressTrackB" data-input="currentMoneyB">
                <div class="progress-fill"></div>
                <!-- 0.5 (16.66%) -->
                <div class="marker" style="left: 16.66%;">
                    <span class="marker-amount"></span>
                    <span class="marker-label">0.5%</span>
                </div>
                <!-- 1.0 (33.33%) -->
                <div class="marker" style="left: 33.33%;">
                    <span class="marker-amount"></span>
                    <span class="marker-label">1%</span>
                </div>
                <!-- 2.0 (66.66%) -->
                <div class="marker" style="left: 66.66%;">
                    <span class="marker-amount"></span>
                    <span class="marker-label">2%</span>
                </div>
                <!-- 3.0 (100%) -->
                <div class="marker" style="left: 100%;">
                    <span class="marker-amount"></span>
                    <span class="marker-label">3%</span>
                </div>
            </div>
            <div class="result-text">
                현재 진행률: <span class="current-percent">0%</span>
            </div>
        </div>
    </div>

    <script>
        // 프로그래스 바 (금액별 진행률)
        const ProgressBar = {
            // A,B 타입별 고정 가격 매핑 (마커 위치 -> 금액)
            PRICE_MAP: {
                'type-a': [
                    { pos: 0, val: 0, percent: 0 },
                    { pos: 0.5, val: 1500, percent: 16.66 },
                    { pos: 1, val: 2000, percent: 33.33 },
                    { pos: 2, val: 3000, percent: 66.66 },
                    { pos: 3, val: 4000, percent: 100 }
                ],
                'type-b': [
                    { pos: 0, val: 0, percent: 0 },
                    { pos: 0.5, val: 1500, percent: 16.66 },
                    { pos: 1, val: 3000, percent: 33.33 },
                    { pos: 2, val: 4000, percent: 66.66 },
                    { pos: 3, val: 5000, percent: 100 }
                ]
            },
            // 금액 포맷
            formatMoney(val) {
                return new Intl.NumberFormat('ko-KR').format(Math.round(val));
            },
            // 타입 클래스에서 포인트 배열 추출
            getPoints(trackEl) {
                if (trackEl.classList.contains('type-b')) return this.PRICE_MAP['type-b'];
                return this.PRICE_MAP['type-a'];
            },
            // 프로그래스 바 업데이트
            update(trackEl, currentMoney) {
                const points = this.getPoints(trackEl);
                const fillEl = trackEl.querySelector('.progress-fill');
                const markerAmounts = trackEl.querySelectorAll('.marker .marker-amount');
                const percentText = trackEl.closest('.progress-wrapper').querySelector('.current-percent');

                // 마커 라벨에 금액 표시 + 도달 여부 강조
                const markerPoints = points.filter(p => p.pos > 0);
                markerAmounts.forEach((el, idx) => {
                    if (markerPoints[idx]) {
                        el.textContent = this.formatMoney(markerPoints[idx].val);
                        el.classList.toggle('is-reached', currentMoney >= markerPoints[idx].val);
                    }
                });

                const maxMoney = points[points.length - 1].val;
                let finalPercent = 0;

                if (currentMoney <= 0) {
                    finalPercent = 0;
                } else if (currentMoney >= maxMoney) {
                    finalPercent = 100;
                } else {
                    // 다구간 선형 보간으로 퍼센트 계산
                    for (let i = 0; i < points.length - 1; i++) {
                        const p1 = points[i];
                        const p2 = points[i + 1];
                        if (currentMoney >= p1.val && currentMoney <= p2.val) {
                            const ratio = (currentMoney - p1.val) / (p2.val - p1.val);
                            finalPercent = p1.percent + ratio * (p2.percent - p1.percent);
                            break;
                        }
                    }
                }

                fillEl.style.width = `${finalPercent}%`;
                if (percentText) {
                    percentText.textContent = `${finalPercent.toFixed(2)}% (${this.formatMoney(currentMoney)}원)`;
                }
            },
            init() {
                const tracks = document.querySelectorAll('.progress-track');
                if (!tracks.length) return;

                tracks.forEach(trackEl => {
                    // data-input 속성으로 연결된 input 탐색
                    const inputId = trackEl.dataset.input;
                    const input = inputId ? document.getElementById(inputId) : null;

                    // 초기 렌더링
                    const initVal = input ? (parseFloat(input.value) || 0) : 0;
                    this.update(trackEl, initVal);

                    // input 이벤트 바인딩
                    if (input) {
                        input.addEventListener('input', () => {
                            this.update(trackEl, parseFloat(input.value) || 0);
                        });
                    }
                });

                // 유형 선택 전환 로직
                const typeSelect = document.getElementById('typeSelect');
                const wrapperA = document.getElementById('wrapperA');
                const wrapperB = document.getElementById('wrapperB');
                const inputGroupA = document.getElementById('inputGroupA');
                const inputGroupB = document.getElementById('inputGroupB');

                const handleTypeChange = (val) => {
                    if (val === 'type-a') {
                        wrapperA.style.display = 'block';
                        wrapperB.style.display = 'none';
                        inputGroupA.style.display = 'flex';
                        inputGroupB.style.display = 'none';
                    } else {
                        wrapperA.style.display = 'none';
                        wrapperB.style.display = 'block';
                        inputGroupA.style.display = 'none';
                        inputGroupB.style.display = 'flex';
                    }
                };

                typeSelect.addEventListener('change', (e) => handleTypeChange(e.target.value));
                handleTypeChange(typeSelect.value); // 초기 상태 설정
            }
        };

        // DOM 로드 시 실행
        document.addEventListener('DOMContentLoaded', () => ProgressBar.init());
    </script>

</body>

</html>