<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Bar Test</title>
    <style>
        /* 기본 리셋 및 스타일 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            padding: 50px;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            margin-bottom: 30px;
            text-align: center;
            color: #333;
        }

        /* 컨트롤 패널 스타일 */
        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 40px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-size: 14px;
            font-weight: bold;
            color: #555;
        }

        .input-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #ff0000;
        }

        /* 프로그래스 바 영역 스타일 */
        .progress-wrapper {
            position: relative;
            padding: 0 0 40px 0;
            /* 마커 텍스트 공간 확보 */
            margin-top: 50px;
        }

        .progress-track {
            position: relative;
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: visible;
            /* 마커가 튀어나올 수 있도록 */
        }

        .progress-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: #ff0000;
            width: 0%;
            /* JS로 제어 */
            border-radius: 5px;
            transition: width 0.3s ease-out;
            z-index: 1;
        }

        /* 마커 스타일 */
        .markers {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .marker {
            position: absolute;
            top: -5px;
            /* 바 위로 살짝 올라오게 */
            width: 2px;
            height: 20px;
            background-color: #333;
            transform: translateX(-50%);
            /* 정확한 위치를 위해 중심점 이동 */
            z-index: 2;
        }

        .marker-label {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            color: #333;
            font-weight: bold;
            white-space: nowrap;
        }

        .marker-amount {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #888;
            white-space: nowrap;
        }

        /* 결과 텍스트 */
        .result-text {
            margin-top: 30px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .result-text span {
            color: #ff0000;
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>금액별 프로그래스 바 테스트</h2>

        <div class="controls">
            <div class="input-group">
                <label for="minMoney">0.5 지점 금액 (minMoney)</label>
                <input type="number" id="minMoney" value="1500" placeholder="예: 50000">
            </div>
            <div class="input-group">
                <label for="maxMoney">3.0 지점 금액 (maxMoney)</label>
                <input type="number" id="maxMoney" value="6000" placeholder="예: 300000">
            </div>
            <div class="input-group" style="grid-column: span 2;">
                <label for="currentMoney">현재 달성 금액</label>
                <input type="number" id="currentMoney" value="3000" placeholder="금액 입력">
            </div>
        </div>

        <!-- 프로그래스 바 UI -->
        <div class="progress-wrapper">
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>

                <!-- 마커들 (JS로 동적 위치 조정 가능하지만 일단 CSS로 고정 비율 배치) -->
                <!-- 0.5 (16.66%) -->
                <div class="marker" style="left: 16.66%;">
                    <span class="marker-amount" id="label_val_0_5"></span>
                    <span class="marker-label">0.5</span>
                </div>

                <!-- 1.0 (33.33%) -->
                <div class="marker" style="left: 33.33%;">
                    <span class="marker-amount" id="label_val_1"></span>
                    <span class="marker-label">1</span>
                </div>

                <!-- 2.0 (66.66%) -->
                <div class="marker" style="left: 66.66%;">
                    <span class="marker-amount" id="label_val_2"></span>
                    <span class="marker-label">2</span>
                </div>

                <!-- 3.0 (100%) -->
                <div class="marker" style="left: 100%;">
                    <span class="marker-amount" id="label_val_3"></span>
                    <span class="marker-label">3</span>
                </div>
            </div>
        </div>

        <div class="result-text">
            현재 진행률: <span id="currentPercent">0%</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const minMoneyInput = document.getElementById('minMoney');
            const maxMoneyInput = document.getElementById('maxMoney');
            const currentMoneyInput = document.getElementById('currentMoney');
            const progressFill = document.getElementById('progressFill');
            const currentPercentText = document.getElementById('currentPercent');

            // 라벨 엘리먼트들
            const label0_5 = document.getElementById('label_val_0_5');
            const label1 = document.getElementById('label_val_1');
            const label2 = document.getElementById('label_val_2');
            const label3 = document.getElementById('label_val_3');

            // 값 포맷팅 (원 단위 콤마)
            const formatMoney = (val) => {
                return new Intl.NumberFormat('ko-KR').format(Math.round(val));
            };

            // 메인 계산 함수
            const updateProgress = () => {
                const minMoney = parseFloat(minMoneyInput.value) || 0;
                const maxMoney = parseFloat(maxMoneyInput.value) || 0;
                const currentMoney = parseFloat(currentMoneyInput.value) || 0;

                if (maxMoney <= 0) return;

                // 시각적 위치 정의 (Marker Value -> %)
                // 0 -> 0% (Start)
                // 0.5 -> 16.666... (1/6)
                // 1.0 -> 33.333... (1/3)
                // 1.5 -> 50.000... (1/2) - Middle
                // 2.0 -> 66.666... (2/3)
                // 3.0 -> 100.000... (1)

                const posToPercent = (pos) => (pos / 3) * 100;

                // 구간 설정 (Piecewise Linear Interpolation)
                // 사용자의 요청을 만족시키기 위해 '다구간 선형 보간'을 사용합니다.
                // 1. Min (0.5 Marker)
                // 2. Max (3.0 Marker)
                // 3. Middle Check (1.5 Marker = Max/2 Value)

                let points = [
                    { val: 0, pos: 0, percent: 0 },
                    { val: minMoney, pos: 0.5, percent: posToPercent(0.5) }, // 16.66%
                    { val: maxMoney, pos: 3.0, percent: posToPercent(3.0) }  // 100%
                ];

                const midMoney = maxMoney / 2;

                // 만약 Min < Mid < Max 구조라면 중간에 Mid 포인트(1.5 위치)를 강제로 추가하여
                // "3000(Max반) -> 1.5(Label반)" 조건을 만족시킴
                if (midMoney > minMoney && midMoney < maxMoney) {
                    points.splice(2, 0, { val: midMoney, pos: 1.5, percent: posToPercent(1.5) }); // 50%
                }

                // 라벨 값을 계산하기 위한 헬퍼 함수
                const getValueAtPos = (targetPos) => {
                    // 해당 pos가 포함된 구간 찾기 (points는 pos 기준으로 정렬되어 있다 가정하지만 여기선 splice 위치가 정확하므로 정렬 생략)
                    // 하지만 위 코드에서는 points가 val 기준으로 정렬될 수도 있고 pos 기준으로 정렬될 수도 있음.
                    // 여기서는 pos가 Min(0.5) < Mid(1.5)? YES if Min < Mid.
                    // 그러나 Min > Mid 인 경우도 있을 수 있으나, 일반적으로 Min(최소구매금액) < Max(최대금액)/2 일 확률이 높음.
                    // 안전을 위해 pos 기준으로 정렬된 참조 배열을 사용하거나 그냥 계산.

                    // points는 val 기준으로 삽입되었음. (Min < Mid < Max)
                    // 그렇다면 pos 기준도 0.5 < 1.5 < 3.0 이므로 정렬 유지됨.

                    for (let i = 0; i < points.length - 1; i++) {
                        const p1 = points[i];
                        const p2 = points[i + 1];
                        if (targetPos >= p1.pos && targetPos <= p2.pos) {
                            const ratio = (targetPos - p1.pos) / (p2.pos - p1.pos);
                            return p1.val + ratio * (p2.val - p1.val);
                        }
                    }
                    // 범위 밖
                    if (targetPos > 3.0) return maxMoney;
                    return 0;
                };

                // 마커 라벨 업데이트 (동적 계산)
                // 주의: 위 로직에 따르면 마커 1, 2의 값이 Min과 Max/2 사이에서 유동적으로 변함
                label0_5.textContent = formatMoney(getValueAtPos(0.5)); // minMoney
                label1.textContent = formatMoney(getValueAtPos(1.0));
                label2.textContent = formatMoney(getValueAtPos(2.0));
                label3.textContent = formatMoney(getValueAtPos(3.0)); // maxMoney

                // 3. 현재 금액에 따른 % 계산
                let finalPercent = 0;

                if (currentMoney <= 0) {
                    finalPercent = 0;
                } else if (currentMoney >= maxMoney) {
                    finalPercent = 100;
                } else {
                    // 현재 금액이 포함된 구간 찾기
                    for (let i = 0; i < points.length - 1; i++) {
                        const p1 = points[i];
                        const p2 = points[i + 1];
                        if (currentMoney >= p1.val && currentMoney <= p2.val) {
                            const ratio = (currentMoney - p1.val) / (p2.val - p1.val);
                            // 이미 계산된 percent 값 사용
                            finalPercent = p1.percent + ratio * (p2.percent - p1.percent);
                            break;
                        }
                    }
                }

                // result-text에 포인트 정보 표시 (디버깅용, 필요 시 제거)
                // console.log("Points:", points);

                // UI 적용
                progressFill.style.width = `${finalPercent}%`;
                currentPercentText.textContent = `${finalPercent.toFixed(2)}% (${formatMoney(currentMoney)}원)`;
            };

            // 이벤트 리스너 등록
            [minMoneyInput, maxMoneyInput, currentMoneyInput].forEach(input => {
                input.addEventListener('input', updateProgress);
            });

            // 초기 실행
            updateProgress();
        });
    </script>

</body>

</html>